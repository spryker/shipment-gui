{% extends '@Gui/Layout/layout.twig' %}

{% block action %}
    {{ backActionButton('/sales/detail/?id-sales-order=' ~ idSalesOrder, 'Back to Order' | trans) }}
{% endblock %}

{% block section_title %}
    {{ 'New Shipment for Order: N%idSalesOrder%' | trans({'%idSalesOrder%': idSalesOrder}) }}
{% endblock %}

{% block content %}
    {{ form_start(form) }}
        {{ form_widget(form.id_sales_shipment) }}
        {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Delivery Address' } %}
            {% block widget_content %}
                {{ form_row(form.id_shipping_address) }}
                {{ form_row(form.shipping_address) }}
            {% endblock %}
        {% endembed %}
        {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Shipment method' } %}
            {% block widget_content %}
                {{ form_row(form.id_shipment_method) }}
            {% endblock %}
        {% endembed %}
        {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Requested delivery date' } %}
            {% block widget_content %}
                {{ form_row(form.requested_delivery_date) }}
            {% endblock %}
        {% endembed %}
        {% embed '@Gui/Partials/widget.twig' with { widget_title: 'Order items inside this shipment' } %}
            {% block widget_content %}
                <table class="footable table toggle-arrow-tiny" data-qa="order-item-list">
                    <thead>
                        <th/>
                        <th/>
                        <th>{{ 'Product' | trans }}</th>
                        <th>{{ 'Quantity' | trans }}</th>
                        <th>{{ 'Sate' | trans }}</th>
                        <th>{{ 'Current shipment' | trans }}</th>
                    </thead>
                    <tbody>
                    {% for item in form.items %}
                        {% set itemData = item.vars.data %}
                        <tr>
                            <td class="item-checker">
                                {{ form_row(item) }}
                            </td>
                            <td>
                                <img class="product-image" src="{{ itemData.metadata.image }}" width="100"/>
                            </td>
                            <td>
                                <div>
                                    <a target="_blank" href="{{ url('/product-management/view/variant', {'id-product-abstract': itemData.idProductAbstract, 'id-product': itemData.id, 'type': 'regular'}) }}">
                                        {{ itemData.name }}
                                    </a>
                                </div>
                                <div class="sku">
                                    {{ 'Sku' | trans }}: <span>{{ itemData.sku }}</span>
                                </div>
                            </td>
                            <td>
                                {{ itemData.quantity }}
                            </td>
                            <td class="state-history">
                                <div>
                                    <a href="{{ url('/oms/index/draw', {'process': itemData.process, 'state': itemData.state.name}) }}" target="_blank">{{ (itemData.stateHistory | first).name }}</a> ({{ itemData.process }})
                                </div>
                                {% if itemData.stateHistory | length > 1 %}
                                    <div id="history_details_{{ itemData.idSalesOrderItem }}" class="hidden">
                                        {% for stateHistory in itemData.stateHistory | slice(1) %}
                                            <div>{{ stateHistory.name }} ({{ stateHistory.createdAt | formatDateTime }})</div>
                                        {% endfor %}
                                    </div>
                                    <a id="history-btn-{{ itemData.idSalesOrderItem }}"
                                       class="btn btn-sm more-history is-hidden"
                                       data-id="{{ itemData.idSalesOrderItem }}">
                                        <span class="show-more">{{ 'Show history' | trans }}</span>
                                        <span class="show-less">{{ 'Hide history' | trans }}</span>
                                    </a>
                                {% endif %}
                            </td>
                            <td>
                                {{ itemData.shipment.carrier.name ~ ' - ' ~ itemData.shipment.method.name }}
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            {% endblock %}
        {% endembed %}
        <input type="submit" class="btn btn-primary safe-submit" value="{{ 'Save' | trans }}"/>
    {{ form_end(form) }}
{% endblock %}


{% block head_css %}
    {{ parent() }}
{% endblock %}

{% block footer_js %}
    {{ parent() }}
    <script src="/assets/js/spryker-zed-shipmentgui-main.js"></script>
{% endblock %}